function sendNewBirthdayReminders() {
  var spreadsheet = SpreadsheetApp.openById("13N-sl98Xc1s4QDPXoppMZ5LIt9D9ZWHpZjK9XgA3RiE");
  var sheet = spreadsheet.getSheetByName("Sheet1");

  var today = new Date();

  var startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
  var endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 7);

  var employees = sheet.getRange("A2:P" + sheet.getLastRow()).getValues();

  var birthdayList = [];

  for (var i = 0; i < employees.length; i++) {
    var employee = employees[i];
    var birthday = new Date(employee[11]);

    var name = employee[1];
    var department = employee[2];
    var age = today.getFullYear() - birthday.getFullYear();

    var birthdayInfo = {
      name: name,
      department: department,
      age: age,
      birthday: birthday
    };

    birthdayList.push(birthdayInfo);
  }

  if (birthdayList.length > 0) {
    var subject = "Дни рождения на этой неделе";
    var body = "На следующей неделе (" + formatDate(startDate) + " - " + formatDate(endDate) + ") у этих сотрудников дни рождения:\n\n";

    for (var j = 0; j < birthdayList.length; j++) {
      var birthdayInfo = birthdayList[j];
      body += formatDate(birthdayInfo.birthday, "dd MMMM") + "\n";
      body += (j + 1) + ". " + birthdayInfo.name + ", подразделение " + birthdayInfo.department + " - исполняется " + birthdayInfo.age + " " + getAgeLabel(birthdayInfo.age) + " - " + formatDate(birthdayInfo.birthday) + "\n\n";
    }

    MailApp.sendEmail("roman.rodionov.20@mail.ru", subject, body);
  }
  else {
    var subject = "Дни рождения на этой неделе";
    var body = "На следующей неделе (" + formatDate(startDate) + " - " + formatDate(endDate) + ")";

    MailApp.sendEmail("roman.rodionov.20@mail.ru", subject, body);
  }
}

function formatDate(date, format) {
  return Utilities.formatDate(date, "GMT+3", format);
}

function getAgeLabel(age) {
  if (age % 10 === 1 && age !== 11) {
    return "год";
  } else if ((age % 10 === 2 || age % 10 === 3 || age % 10 === 4) && !(age >= 12 && age <= 14)) {
    return "года";
  } else {
    return "лет";
  }
}
